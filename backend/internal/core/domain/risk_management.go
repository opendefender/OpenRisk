package domain

import (
	"database/sql/driver"
	"encoding/json"
	"time"

	"github.com/google/uuid"
	"github.com/lib/pq"
	"gorm.io/datatypes"
	"gorm.io/gorm"
)

// Risk Management Policy
type RiskManagementPolicy struct {
	ID                     uuid.UUID          `gorm:"type:uuid;primaryKey" json:"id"`
	TenantID               uuid.UUID          `gorm:"type:uuid;index" json:"tenant_id"`
	PolicyName             string             `gorm:"size:255;not null" json:"policy_name"`
	Version                string             `gorm:"size:50;not null" json:"version"`

}	return json.Marshal(r)func (r *RiskToleranceConfig) Value() (driver.Value, error) {}	return json.Unmarshal(bytes, &r)	bytes, _ := value.([]byte)func (r *RiskToleranceConfig) Scan(value interface{}) error {}	Critical int `json:"critical"`	High     int `json:"high"`	Medium   int `json:"medium"`	Low      int `json:"low"`type RiskToleranceConfig struct {// Helper type for risk tolerance configuration}	DeletedAt             gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt             time.Time      `json:"updated_at"`	CreatedAt             time.Time      `json:"created_at"`	Status                string         `gorm:"size:50;index;default:'PENDING'" json:"status"`	ValidUntil            time.Time `json:"valid_until"`	ValidFrom             time.Time `json:"valid_from"`	IsVerified            bool      `default:"false" json:"is_verified"`	VerificationDate      time.Time `json:"verification_date"`	VerifiedBy            uuid.UUID `gorm:"type:uuid" json:"verified_by"`	RequirementReference  string `gorm:"size:255" json:"requirement_reference"`	ComplianceFramework   string `gorm:"size:100;index" json:"compliance_framework"`	FileSize              int    `json:"file_size"`	FileType              string `gorm:"size:50" json:"file_type"`	FilePath              string `gorm:"size:500" json:"file_path"`	CollectedBy  uuid.UUID `gorm:"type:uuid;not null" json:"collected_by"`	EvidenceDate time.Time `json:"evidence_date"`	EvidenceDescription string    `gorm:"type:text" json:"evidence_description"`	EvidenceTitle       string    `gorm:"size:255;not null" json:"evidence_title"`	EvidenceType        string    `gorm:"size:100;not null" json:"evidence_type"`	RiskRegisterID uuid.UUID `gorm:"type:uuid;index" json:"risk_register_id"`	TenantID       uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskComplianceEvidence struct {// Risk Compliance Evidence}	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	CreatedAt time.Time      `json:"created_at"`	ApprovedBy       uuid.UUID `gorm:"type:uuid" json:"approved_by"`	ApprovalRequired bool      `default:"false" json:"approval_required"`	ReasonForChange  string    `gorm:"type:text" json:"reason_for_change"`	NewValue      string `gorm:"type:text" json:"new_value"`	OldValue      string `gorm:"type:text" json:"old_value"`	FieldName     string `gorm:"size:255" json:"field_name"`	ChangedAt     time.Time `gorm:"index;default:CURRENT_TIMESTAMP" json:"changed_at"`	ChangedBy     uuid.UUID `gorm:"type:uuid;not null;index" json:"changed_by"`	ChangeType    string    `gorm:"size:50;not null" json:"change_type"`	EntityID   uuid.UUID `gorm:"type:uuid;not null;index" json:"entity_id"`	EntityType string    `gorm:"size:100;not null;index" json:"entity_type"`	RiskRegisterID uuid.UUID `gorm:"type:uuid;index" json:"risk_register_id"`	TenantID       uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskChangeLog struct {// Risk Change Log}	DeletedAt              gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt              time.Time      `json:"updated_at"`	CreatedAt              time.Time      `json:"created_at"`	SignedOffDate          time.Time `json:"signed_off_date"`	SignedOffBy            uuid.UUID `gorm:"type:uuid" json:"signed_off_by"`	IsSignedOff            bool      `default:"false" json:"is_signed_off"`	Status                 string    `gorm:"size:50;index;default:'DRAFT'" json:"status"`	ReviewComments         string    `gorm:"type:text" json:"review_comments"`	ReviewDate             time.Time `json:"review_date"`	ReviewedBy             uuid.UUID `gorm:"type:uuid" json:"reviewed_by"`	PolicyChanges          datatypes.JSON `gorm:"type:jsonb" json:"policy_changes"`	DecisionHistory        datatypes.JSON `gorm:"type:jsonb" json:"decision_history"`	RiskSnapshots          datatypes.JSON `gorm:"type:jsonb" json:"risk_snapshots"`	TreatmentsOverdue      int `json:"treatments_overdue"`	TreatmentsCompleted    int `json:"treatments_completed"`	TreatmentsActive       int `json:"treatments_active"`	RisksBySeverity        datatypes.JSON `gorm:"type:jsonb" json:"risks_by_severity"`	RisksByStatus          datatypes.JSON `gorm:"type:jsonb" json:"risks_by_status"`	TotalRisks             int            `json:"total_risks"`	MetricsAndAnalytics    datatypes.JSON `gorm:"type:jsonb" json:"metrics_and_analytics"`	KeyFindings            string         `gorm:"type:text" json:"key_findings"`	ExecutiveSummary       string         `gorm:"type:text" json:"executive_summary"`	ComplianceStatus       datatypes.JSON `gorm:"type:jsonb" json:"compliance_status"`	FrameworksAudited      pq.StringArray `gorm:"type:text[]" json:"frameworks_audited"`	GeneratedDate time.Time `gorm:"index;default:CURRENT_TIMESTAMP" json:"generated_date"`	GeneratedBy   uuid.UUID `gorm:"type:uuid;not null" json:"generated_by"`	ReportingPeriodEnd   time.Time `json:"reporting_period_end"`	ReportingPeriodStart time.Time `json:"reporting_period_start"`		ReportType   string    `gorm:"size:100;not null" json:"report_type"`	ReportTitle  string    `gorm:"size:255;not null" json:"report_title"`	TenantID uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskAuditReport struct {// Risk Audit Report}	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	IsConfidential       bool           `default:"false" json:"is_confidential"`	DistributionList    pq.StringArray `gorm:"type:text[]" json:"distribution_list"`	ApprovedBy          uuid.UUID `gorm:"type:uuid" json:"approved_by"`	ApprovalStatus      string    `gorm:"size:50;default:'DRAFT'" json:"approval_status"`	Escalations         datatypes.JSON `gorm:"type:jsonb" json:"escalations"`	RisksIdentified     datatypes.JSON `gorm:"type:jsonb" json:"risks_identified"`	RisksDiscussed      pq.UUIDArray   `gorm:"type:uuid[]" json:"risks_discussed"`	ActionItems         datatypes.JSON `gorm:"type:jsonb" json:"action_items"`	KeyDecisions        datatypes.JSON `gorm:"type:jsonb" json:"key_decisions"`	Summary             string         `gorm:"type:text" json:"summary"`	Agenda              string         `gorm:"type:text" json:"agenda"`	AttendeeList  datatypes.JSON `gorm:"type:jsonb" json:"attendee_list"`	Attendees     pq.UUIDArray   `gorm:"type:uuid[]" json:"attendees"`	Facilitator   uuid.UUID      `gorm:"type:uuid;not null" json:"facilitator"`	MeetingDate   time.Time `gorm:"index" json:"meeting_date"`	MeetingType   string    `gorm:"size:100" json:"meeting_type"`	MeetingTitle  string    `gorm:"size:255;not null" json:"meeting_title"`	TenantID uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskMeetingMinutes struct {// Risk Management Meeting Minutes}	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	RelatedDecisions   pq.UUIDArray   `gorm:"type:uuid[]" json:"related_decisions"`	SupportingEvidence datatypes.JSON `gorm:"type:jsonb" json:"supporting_evidence"`	Status             string         `gorm:"size:50;index;default:'PROPOSED'" json:"status"`	RiskAcceptanceValidUntil time.Time `json:"risk_acceptance_valid_until"`	RiskAcceptanceTerms    string    `gorm:"type:text" json:"risk_acceptance_terms"`	ApprovedDate           time.Time `json:"approved_date"`	ApprovedBy             uuid.UUID `gorm:"type:uuid" json:"approved_by"`	ApprovalRequired       bool      `default:"false" json:"approval_required"`	DecisionAuthority      string    `gorm:"size:100" json:"decision_authority"`	AlternativesConsidered string `gorm:"type:text" json:"alternatives_considered"`	RiskFactorsConsidered  string `gorm:"type:text" json:"risk_factors_considered"`	Rationale              string `gorm:"type:text;not null" json:"rationale"`	DecisionDate      time.Time `gorm:"index" json:"decision_date"`	DecisionMakerRole string    `gorm:"size:100" json:"decision_maker_role"`	DecisionMaker     uuid.UUID `gorm:"type:uuid;not null;index" json:"decision_maker"`	DecisionDesc   string `gorm:"type:text;not null" json:"decision_description"`	DecisionTitle  string `gorm:"size:255;not null" json:"decision_title"`	DecisionType   string `gorm:"size:100;not null" json:"decision_type"`	TenantID       uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	RiskRegisterID uuid.UUID `gorm:"type:uuid;not null;index" json:"risk_register_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskDecision struct {// Risk Decision and Traceability}	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	ReviewEvidence      datatypes.JSON `gorm:"type:jsonb" json:"review_evidence"`	EscalationReason    string    `gorm:"type:text" json:"escalation_reason"`	EscalationRequired  bool      `default:"false" json:"escalation_required"`	NextReviewDate      time.Time `json:"next_review_date"`	EffectivenessRating      string `gorm:"size:50" json:"effectiveness_rating"`	RecommendedActions       string `gorm:"type:text" json:"recommended_actions"`	EmergingIssues           string `gorm:"type:text" json:"emerging_issues"`	TreatmentEffectiveness   string `gorm:"type:text" json:"treatment_effectiveness"`	TrendsIdentified         string `gorm:"type:text" json:"trends_identified"`	KeyFindings              string `gorm:"type:text" json:"key_findings"`	StatusChangedTo   string `gorm:"size:50" json:"status_changed_to"`	StatusChangedFrom string `gorm:"size:50" json:"status_changed_from"`	CurrentRiskLevel        string  `gorm:"size:50" json:"current_risk_level"`	CurrentRiskScore        float64 `gorm:"type:numeric(8,2)" json:"current_risk_score"`	CurrentImpactScore      int     `json:"current_impact_score"`	CurrentProbabilityScore int     `json:"current_probability_score"`	ReviewedBy  uuid.UUID `gorm:"type:uuid;not null" json:"reviewed_by"`	ReviewDate  time.Time `gorm:"index" json:"review_date"`	ReviewType  string    `gorm:"size:50;not null" json:"review_type"`	TenantID       uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	RiskRegisterID uuid.UUID `gorm:"type:uuid;not null;index" json:"risk_register_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskMonitoringReview struct {// Risk Monitoring and Review}	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	Comments               string    `gorm:"type:text" json:"comments"`	Dependencies           pq.StringArray `gorm:"type:text[]" json:"dependencies"`	CompletionVerifiedBy   uuid.UUID `gorm:"type:uuid" json:"completion_verified_by"`	CompletionEvidence     string    `gorm:"type:text" json:"completion_evidence"`	Priority               string    `gorm:"size:50;default:'MEDIUM'" json:"priority"`	Status                 string    `gorm:"size:50;index;default:'NOT_STARTED'" json:"status"`	CompletionDate  time.Time `json:"completion_date"`	DueDate         time.Time `json:"due_date"`	StartDate       time.Time `json:"start_date"`	ActionOwner       uuid.UUID `gorm:"type:uuid;not null;index" json:"action_owner"`	ActionDescription string    `gorm:"type:text" json:"action_description"`	ActionName        string    `gorm:"size:255;not null" json:"action_name"`	TenantID        uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	TreatmentPlanID uuid.UUID `gorm:"type:uuid;not null;index" json:"treatment_plan_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskTreatmentAction struct {// Risk Treatment Action}	Actions []RiskTreatmentAction `gorm:"foreignKey:TreatmentPlanID" json:"actions,omitempty"`	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	CreatedBy uuid.UUID      `gorm:"type:uuid;not null" json:"created_by"`		NextReviewDate    time.Time `json:"next_review_date"`	LastReviewDate    time.Time `json:"last_review_date"`	ReviewFrequency   string    `gorm:"size:50" json:"review_frequency"`		ApprovedDate              time.Time `json:"approved_date"`	ApprovedBy                uuid.UUID `gorm:"type:uuid" json:"approved_by"`	ApprovalStatus            string    `gorm:"size:50;default:'PENDING'" json:"approval_status"`	ExpectedResidualRisk      string    `gorm:"size:50" json:"expected_residual_risk"`	Status                    string    `gorm:"size:50;index;default:'PLANNED'" json:"status"`		RequiredResources  string    `gorm:"type:text" json:"required_resources"`	ResponsiblePerson  uuid.UUID `gorm:"type:uuid;index" json:"responsible_person"`	BudgetAllocated    float64   `gorm:"type:numeric(12,2)" json:"budget_allocated"`	EstimatedCost      float64   `gorm:"type:numeric(12,2)" json:"estimated_cost"`		ImplementationEnd   time.Time `json:"implementation_timeline_end"`	ImplementationStart time.Time `json:"implementation_timeline_start"`		TreatmentStrategy   string    `gorm:"type:text" json:"treatment_strategy"`	Description         string    `gorm:"type:text;not null" json:"description"`	TreatmentName       string    `gorm:"size:255;not null" json:"treatment_name"`	TreatmentType       string    `gorm:"size:50;not null" json:"treatment_type"`	TenantID       uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	RiskRegisterID uuid.UUID `gorm:"type:uuid;not null;index" json:"risk_register_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskTreatmentPlan struct {// Risk Treatment Plan}	MonitoringReviews []RiskMonitoringReview `gorm:"foreignKey:RiskRegisterID" json:"monitoring_reviews,omitempty"`	Decisions      []RiskDecision       `gorm:"foreignKey:RiskRegisterID" json:"decisions,omitempty"`	TreatmentPlans []RiskTreatmentPlan  `gorm:"foreignKey:RiskRegisterID" json:"treatment_plans,omitempty"`	DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`	UpdatedAt time.Time      `json:"updated_at"`	CreatedAt time.Time      `json:"created_at"`	Status    string         `gorm:"size:50;index;default:'IDENTIFIED'" json:"status"`		ComplianceFrameworks    pq.StringArray `gorm:"type:text[]" json:"compliance_frameworks"`	ExternalReference       string         `gorm:"size:255" json:"external_reference"`		ResponsibleDept    string    `gorm:"size:255" json:"responsible_department"`	SecondaryOwner     uuid.UUID `gorm:"type:uuid" json:"secondary_owner"`	RiskOwnerEmail     string    `gorm:"size:255" json:"risk_owner_email"`	RiskOwner          uuid.UUID `gorm:"type:uuid;not null;index" json:"risk_owner"`		EvaluatedBy         uuid.UUID          `gorm:"type:uuid" json:"evaluated_by"`	EvaluationCriteria  datatypes.JSON     `gorm:"type:jsonb" json:"evaluation_criteria"`	RiskPriority        int                `json:"risk_priority"`	ResidualRiskLevel   string             `gorm:"size:50;default:'HIGH'" json:"residual_risk_level"`	InherentRiskLevel   string             `gorm:"size:50" json:"inherent_risk_level"`	EvaluationDate      time.Time          `json:"evaluation_date"`		AnalyzedBy            uuid.UUID              `gorm:"type:uuid" json:"analyzed_by"`	AnalysisNotes         string                 `gorm:"type:text" json:"analysis_notes"`	PotentialConsequences string                 `gorm:"type:text" json:"potential_consequences"`	RootCauses            string                 `gorm:"type:text" json:"root_causes"`	AffectedAreas         pq.StringArray         `gorm:"type:text[]" json:"affected_areas"`	RiskScore             float64                `gorm:"type:numeric(8,2)" json:"risk_score"`	ImpactScore           int                    `json:"impact_score"`	ProbabilityScore      int                    `json:"probability_score"`	AnalysisMethodology   string                 `gorm:"size:100" json:"analysis_methodology"`	AnalysisDate          time.Time              `json:"analysis_date"`		RiskContext          string    `gorm:"type:text" json:"risk_context"`	RiskCategory         string    `gorm:"size:100" json:"risk_category"`	IdentificationMethod string    `gorm:"size:100" json:"identification_method"`	IdentifiedBy         uuid.UUID `gorm:"type:uuid" json:"identified_by"`	IdentificationDate   time.Time `json:"identification_date"`	TenantID uuid.UUID `gorm:"type:uuid;index" json:"tenant_id"`	RiskID   uuid.UUID `gorm:"type:uuid;unique;not null" json:"risk_id"`	ID uuid.UUID `gorm:"type:uuid;primaryKey" json:"id"`type RiskRegister struct {// Extended Risk Register}	DeletedAt              gorm.DeletedAt     `gorm:"index" json:"-"`	UpdatedAt              time.Time          `json:"updated_at"`	CreatedAt              time.Time          `json:"created_at"`	CreatedBy              uuid.UUID          `gorm:"type:uuid" json:"created_by"`	Status                 string             `gorm:"size:50;default:'DRAFT'" json:"status"`	ApprovalChain          datatypes.JSON     `gorm:"type:jsonb" json:"approval_chain"`	RolesResponsibilities  datatypes.JSON     `gorm:"type:jsonb" json:"roles_responsibilities"`	Methodology            string             `gorm:"size:255" json:"methodology"`	RiskToleranceLevels    datatypes.JSON     `gorm:"type:jsonb" json:"risk_tolerance_levels"`	RiskAppetite           string             `gorm:"type:text" json:"risk_appetite"`	GovernanceFramework    string             `gorm:"size:100" json:"governance_framework"`	ReviewDate             time.Time          `json:"review_date"`	EffectiveDate          time.Time          `json:"effective_date"`